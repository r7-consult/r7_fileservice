# ๐๏ธ Free XLS FileService

**Free XLS FileService** โ ััะพ ะฑะตัะฟะปะฐัะฝัะน ะบัะพััะฟะปะฐััะพัะผะตะฝะฝัะน ะฒะตะฑ-ัะตัะฒะธั ะดะปั ะฝะตะบะพะผะผะตััะตัะบะพะณะพ ะธัะฟะพะปัะทะพะฒะฐะฝะธั, ะบะพัะพััะน ะฟะพะทะฒะพะปัะตั ัะฐะฑะพัะฐัั ั ะดะฐะฝะฝัะผะธ ะธะท Excel-ัะฐะนะปะพะฒ ะบะฐะบ ั SQL-ัะฐะฑะปะธัะฐะผะธ. ะก ะตะณะพ ะฟะพะผะพััั ะผะพะถะฝะพ ะพะฑัะฐัะฐัััั ะบ ะดะฐะฝะฝัะผ Excel ัะตัะตะท web API, ะพัะฟัะฐะฒะปัั GET-ะทะฐะฟัะพัั, ะฝะฐะฟัะธะผะตั, ะธะท ะผะฐะบัะพัะพะฒ ะ7-ะัะธั.


## ะฃััะฐะฝะพะฒะบะฐ ะธ ะทะฐะฟััะบ ัะตัะฒะธัะฐ

### ะะฐัะธะฐะฝั 1: ะััะฝะพะน ะทะฐะฟััะบ ะธะท ะธััะพะดะฝะธะบะพะฒ

```bash
git clone https://github.com/r7-consult/r7_fileservice.git
cd r7_fileservice
pip install -r requirements.txt
python -m xldb-proxy-file
```

### ะะฐัะธะฐะฝั 2: ะะฐะฟััะบ ะธะท ะณะพัะพะฒะพะน ัะฑะพัะบะธ

ะกะบะฐัะฐะนัะต ะธัะฟะพะปะฝัะตะผัะน ัะฐะนะป ะดะปั ะฒะฐัะตะน ัะธััะตะผั:

- [โฌ Windows](./build/r7_fileservice-windows.exe)
- [โฌ Ubuntu](./build/r7_fileservice-ubuntu.bin)
- [โฌ RedOS](./build/r7_fileservice-redos.bin)
- [โฌ AstraOS](./build/r7_fileservice-astra.bin)

ะะฐัะตะผ ะฟัะพััะพ ะฒัะฟะพะปะฝะธัะต:

```bash
./r7_fileservice-[os] //ะทะฐะฟัััะธัะต ะฝัะถะฝัะน ะฑะธะปะด
``` 
ะะพ ัะผะพะปัะฐะฝะธั ัะตัะฒะธั ะทะฐะฟััะบะฐะตััั ะฝะฐ http://127.0.0.1:58081

## ะะพะทะผะพะถะฝะพััะธ ะธ ะฟัะธะผะตัั ัะฐะฑะพัั

### GET /file/list
ะะพะปััะตะฝะธะต ัะฟะธัะบะฐ ัะฐะนะปะพะฒ ะฒ ะดะธัะตะบัะพัะธะธ
```bash
http://localhost:58081/file/list?path=C:\
```
ะัะฒะตั:
- ะฃัะฟะตั: `{"files": ["file1.xlsx", "file2.xlsx", ...]}` - ัะฟะธัะพะบ ัะฐะนะปะพะฒ
- ะัะธะฑะบะฐ: HTTP 500 ั ะพะฟะธัะฐะฝะธะตะผ ะพัะธะฑะบะธ (ะฝะฐะฟัะธะผะตั, ะดะธัะตะบัะพัะธั ะฝะต ัััะตััะฒัะตั)

### GET /file/available
ะัะพะฒะตัะบะฐ ัััะตััะฒะพะฒะฐะฝะธั ัะฐะนะปะฐ
```bash
http://localhost:58081/file/available?path=C:\&file_name=example.xlsx
```
ะัะฒะตั:
- ะคะฐะนะป ัััะตััะฒัะตั: `{"status": "OK"}`
- ะคะฐะนะป ะฝะต ัััะตััะฒัะตั: `{"status": "Error"}`
- ะัะธะฑะบะฐ: HTTP 500 ั ะพะฟะธัะฐะฝะธะตะผ ะพัะธะฑะบะธ

### GET /file/meta
ะะพะปััะตะฝะธะต ะผะตัะฐะดะฐะฝะฝัั ัะฐะนะปะฐ
```bash
http://localhost:58081/file/meta?path=C:\&file_name=example.xlsx
```
ะัะฒะตั:
- ะฃัะฟะตั: JSON ั ะผะตัะฐะดะฐะฝะฝัะผะธ ัะฐะนะปะฐ:
  ```json
  {
    "file_name": "example.xlsx",
    "file_path": "C:\\example.xlsx",
    "size_bytes": 1234,
    "created_at": "2025-05-20T12:00:00",
    "modified_at": "2025-05-20T12:00:00",
    "accessed_at": "2025-05-20T12:00:00",
    "mode": "0o100666",
    "sheets": ["Sheet1", "Sheet2"],
    "copyright": "Free for non commercial use https://r7-consult.ru/"
  }
  ```
- ะัะธะฑะบะฐ: HTTP 500 ั ะพะฟะธัะฐะฝะธะตะผ ะพัะธะฑะบะธ

### GET /file/register
ะัะพะฒะตัะบะฐ ะฒะพะทะผะพะถะฝะพััะธ ััะตะฝะธั Excel-ัะฐะนะปะฐ ะธ ะฟะพะปััะตะฝะธะต ะธะฝัะพัะผะฐัะธะธ ะพ ะตะณะพ ััััะบัััะต
```bash
http://localhost:58081/file/register?path=C:\&file_name=example.xlsx&sheet_name=Sheet1&usecols=A,B,C&skiprows=0&nrows=1000
```
ะะฐัะฐะผะตััั:
- `sheet_name`: ะธะผั ะปะธััะฐ (ะพะฟัะธะพะฝะฐะปัะฝะพ)
- `usecols`: ัะฟะธัะพะบ ะบะพะปะพะฝะพะบ (ะพะฟัะธะพะฝะฐะปัะฝะพ)
- `skiprows`: ะฟัะพะฟัััะธัั ัััะพะบ ัะฒะตััั (ะฟะพ ัะผะพะปัะฐะฝะธั 0)
- `nrows`: ะผะฐะบัะธะผะฐะปัะฝะพะต ัะธัะปะพ ัััะพะบ (ะฟะพ ัะผะพะปัะฐะฝะธั 10000000)

ะัะฒะตั:
- ะฃัะฟะตั: `{"columns": ["col1", "col2", ...], "rows": 1000}` - ัะฟะธัะพะบ ะบะพะปะพะฝะพะบ ะธ ะบะพะปะธัะตััะฒะพ ัััะพะบ ะฒ ัะฐะนะปะต
- ะัะธะฑะบะฐ: HTTP 500 ั ะพะฟะธัะฐะฝะธะตะผ ะพัะธะฑะบะธ

### GET /file/sql
ะัะฟะพะปะฝะตะฝะธะต SQL-ะทะฐะฟัะพัะฐ ะบ Excel-ัะฐะนะปั
```bash
http://localhost:58081/file/sql?query=select%20*%20from%20df&path=C:\&file_name=example.xlsx&sheet_name=Sheet1
```
ะะฐัะฐะผะตััั:
- ะขะต ะถะต, ััะพ ะธ ะดะปั `/file/register`
- `query`: SQL-ะทะฐะฟัะพั (ะดะฐะฝะฝัะต ะดะพัััะฟะฝั ะฒ ัะฐะฑะปะธัะต ั ะธะผะตะฝะตะผ `df`)

ะัะธะผะตัั ะทะฐะฟัะพัะพะฒ:
```sql
select * from df                           -- ะฒัะต ะดะฐะฝะฝัะต
select col1, col2 from df                  -- ัะพะปัะบะพ ะฝัะถะฝัะต ะบะพะปะพะฝะบะธ
select * from df where col1 > 100          -- ั ััะปะพะฒะธะตะผ
select col1, count(*) from df group by col1 -- ั ะณััะฟะฟะธัะพะฒะบะพะน
```

ะัะฒะตั:
- ะฃัะฟะตั: ะะฐััะธะฒ ะทะฐะฟะธัะตะน ั ัะตะทัะปััะฐัะฐะผะธ ะทะฐะฟัะพัะฐ
- ะัะธะฑะบะฐ: HTTP 500 ั ะพะฟะธัะฐะฝะธะตะผ ะพัะธะฑะบะธ

### ะัะพะฑัะฐะถะตะฝะธะต ัะตะทัะปััะฐัะพะฒ ะฝะฐ ะปะธััะต ะ7 ัะตัะตะท ะผะฐะบัะพัั

ะะปั ะพัะพะฑัะฐะถะตะฝะธั ัะตะทัะปััะฐัะพะฒ SQL-ะทะฐะฟัะพัะฐ ะฝะฐ ะปะธััะต ะ7-ะัะธั ะผะพะถะฝะพ ะธัะฟะพะปัะทะพะฒะฐัั ัะปะตะดัััะธะน ะผะฐะบัะพั:

```javascript
(function() {
  // URL ั SQL-ะทะฐะฟัะพัะพะผ ะบ ัะฐะนะปั Excel
  var url = "http://localhost:58081/file/sql?query=select%20*%20from%20df&path=C:\\tt&file_name=address.xlsx&sheet_name=Sheet1";

  fetch(url)
    .then(response => response.json())  // ะะฐััะธะผ ะพัะฒะตั ะบะฐะบ JSON
    .then(data => {
      var oWorksheet = Api.GetActiveSheet();  // ะะพะปััะฐะตะผ ะฐะบัะธะฒะฝัะน ะปะธัั

      // ะกัะธััะฒะฐะตะผ ะทะฐะณะพะปะพะฒะบะธ ะธะท ะฟะตัะฒะพะณะพ ะพะฑัะตะบัะฐ JSON
      var headers = Object.keys(data[0]);

      // ะัะตะพะฑัะฐะทัะตะผ ะดะฐะฝะฝัะต ะฒ ะดะฒัะผะตัะฝัะน ะผะฐััะธะฒ ะฟะพ ะฟะพััะดะบั ะทะฐะณะพะปะพะฒะบะพะฒ
      var sData = data.map(row => headers.map(h => row[h] || ''));

      // ะะฑัะตะดะธะฝัะตะผ ะทะฐะณะพะปะพะฒะบะธ ะธ ัััะพะบะธ ะดะฐะฝะฝัั
      var fullArray = [headers, ...sData];

      // ะะพะปััะฐะตะผ ะดะธะฐะฟะฐะทะพะฝ ะดะปั ะฒัะตะน ัะฐะฑะปะธัั
      var dataRange = oWorksheet.GetRange(
        oWorksheet.GetRangeByNumber(0, 0),
        oWorksheet.GetRangeByNumber(fullArray.length - 1, headers.length - 1)
      );

      // ะััะฐะฒะปัะตะผ ะฒัะต ะทะฝะฐัะตะฝะธั ะพะดะฝะพะน ะพะฟะตัะฐัะธะตะน
      dataRange.SetValue(fullArray);

      // ะะตัะตัะธัะพะฒัะฒะฐะตะผ ะดะพะบัะผะตะฝั
      Api.asc_calculate(Asc.c_oAscCalculateType.ActiveSheet);
    })
    .catch(error => {
      console.log("ะัะธะฑะบะฐ ะฟัะธ ะฟะพะปััะตะฝะธะธ ะดะฐะฝะฝัั:", error);
    });
})();
```

ะะฐะบัะพั ะฒัะฟะพะปะฝัะตั ัะปะตะดัััะธะต ะดะตะนััะฒะธั:
1. ะัะฟัะฐะฒะปัะตั GET-ะทะฐะฟัะพั ะบ ัะตัะฒะธัั ั SQL-ะทะฐะฟัะพัะพะผ
2. ะะพะปััะฐะตั ะดะฐะฝะฝัะต ะฒ ัะพัะผะฐัะต JSON
3. ะัะตะพะฑัะฐะทัะตั ะดะฐะฝะฝัะต ะดะปั ะฒััะฐะฒะบะธ ะฒ ัะฐะฑะปะธัั:
   - ะะตัะฒะฐั ัััะพะบะฐ - ะทะฐะณะพะปะพะฒะบะธ ะบะพะปะพะฝะพะบ
   - ะััะฐะปัะฝัะต ัััะพะบะธ - ะดะฐะฝะฝัะต ะธะท ัะตะทัะปััะฐัะฐ ะทะฐะฟัะพัะฐ
4. ะััะฐะฒะปัะตั ะดะฐะฝะฝัะต ะฒ ะฐะบัะธะฒะฝัะน ะปะธัั, ะฝะฐัะธะฝะฐั ั ััะตะนะบะธ A1
5. ะะฑะฝะพะฒะปัะตั ะพัะพะฑัะฐะถะตะฝะธะต ะปะธััะฐ

> **ะะฐะถะฝะพ**: ะะปั ะพัะพะฑัะฐะถะตะฝะธั ะธะทะผะตะฝะตะฝะธะน ะฟะพัะปะต ะฒัะฟะพะปะฝะตะฝะธั ะผะฐะบัะพัะฐ ะธัะฟะพะปัะทัะตััั ะบะพะผะฐะฝะดะฐ `Api.asc_calculate()`, ัะฐะบ ะบะฐะบ ะฟะพ ัะผะพะปัะฐะฝะธั ะผะฐะบัะพั ะฝะต ะพะฑะฝะพะฒะปัะตั ัะพะดะตัะถะธะผะพะต ะดะพะบัะผะตะฝัะฐ.

## ะกัััะบัััะฐ ะฟัะพะตะบัะฐ

```text
r7_fileservice/
โโโ src/
โ   โโโ logger_conf.py
โ   โโโ main.py
โ   โโโ r7_fileservice.py
โ   โโโ reporting.py
โ   โโโ svc_xls_files.py
โ   โโโ types_meta.py
โโโ build/
โ   โโโ r7_fileservice-windows.exe
โ   โโโ r7_fileservice-ubuntu.bin
โ   โโโ r7_fileservice-redos.bin
โ   โโโ r7_fileservice-astra.bin
โโโ requirements.txt
โโโ README.md
```


## ะะพะฝัะฐะบัั
- ะกะฐะนั: [ะ7-ะะพะฝัะฐะปั](https://r7-consult.ru/)
- Email: er@exceldb.pro
- ะขะตะปะตัะพะฝ: +7 915 258-0371
- Telegram: https://t.me/r7_js
